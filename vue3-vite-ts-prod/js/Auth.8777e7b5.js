import{a as e,j as a,n as l,l as t,f as s,g as i,o,p as n,q as d,r,e as u,h as m,v as c}from"./element-plus.d9718458.js";import{_ as f,a as p,b as g}from"./Search.4da002f7.js";import"./vue.ea117135.js";import{A as b,k as v,l as h,m as y,n as k,o as j,p as _,a as D}from"./index.f86f8509.js";import{l as w}from"./lodash.a57d72c0.js";import{u as C}from"./vuex.16220312.js";import{d as x,b as V,Z as q,j as B,c as M,U as T,u as I,O as L,o as z,a as O,S as A,P as U,M as K,T as P,F as R,a7 as S,R as F}from"./@vue.eb62a264.js";import"./lodash-es.d4f5f48c.js";import"./@vueuse.45c6cd4e.js";import"./@element-plus.30484454.js";import"./@popperjs.b78c3215.js";import"./@ctrl.91de2ec7.js";import"./dayjs.11b573ac.js";import"./async-validator.7592c8ba.js";import"./memoize-one.63ab667a.js";import"./normalize-wheel-es.3222b0a2.js";import"./@floating-ui.36fbce82.js";import"./vue-router.b3f333f3.js";import"./axios.5fdf0182.js";import"./universal-cookie.a55469f4.js";import"./mqtt.f77a2428.js";const E={class:"flex flex-column height-100p"},H={class:"flex width-100p"},Q=["onClick"],Z={key:0,class:"flex-1"},$={class:"dialog-footer"},G=D(x({__name:"Auth",setup(D){const x=C(),G=V(null),J=V(),N=q([{type:"input",label:"权限名称",key:"name",value:""},{type:"select",label:"状态",key:"status",options:[{label:"启用",value:1},{label:"禁用",value:2}]}]),W=q({page:1,size:10}),X=q([{label:"权限名称",key:"name",width:90},{type:"select",label:"状态",key:"status",options:{0:"注销",1:"启用",2:"禁用"},width:90},{label:"备注",key:"remarks",width:90},{type:"datetime",label:"创建时间",key:"createdAt"},{type:"datetime",label:"修改时间",key:"updatedAt"}]),Y=q({loading:!1,data:[],selectData:[],page:1,size:10,total:0}),ee=q([{type:"success",label:"添加",key:"add"},{type:"primary",label:"编辑",key:"edit"},{type:"success",label:"启用",key:"on"},{type:"primary",label:"禁用",key:"off"},{type:"danger",label:"删除",key:"delete"}]),ae={1:"菜单",2:"页面",3:"按钮"},le=q({visible:!1,title:"权限",btnType:"",formData:{loading:!1,_id:"",name:"",status:1,checkedMenu:[],halfCheckedMenu:[],btns:[],remarks:""},clickTreeItem:{},authBtns:[]});B((()=>{se()}));const te=e=>{Object.assign(W,e),se(1)},se=(e=Y.page,a=Y.size)=>{Y.loading=!0,b({...W,page:e,size:a}).then((e=>{Object.assign(Y,e.data)})).finally((()=>{Y.loading=!1}))},ie=async(a,l={})=>{switch(a.key){case"add":le.visible=!0,le.title=null==a?void 0:a.label,le.btnType=null==a?void 0:a.key;break;case"edit":if(1!=Y.selectData.length)return e.warning("请选择一条数据");le.visible=!0,le.title=null==a?void 0:a.label,le.btnType=null==a?void 0:a.key,Object.assign(le.formData,await oe(Y.selectData[0])),J.value.setCheckedKeys(le.formData.checkedMenu);break;case"delete":de();break;case"on":case"off":re(a);break;default:e.info("暂未开启，敬请期待")}},oe=({_id:e})=>new Promise(((a,l)=>{v({_id:e}).then((e=>{a(e.data)}))})),ne=w.debounce((()=>{Object.assign(le.formData,{checkedMenu:J.value.getCheckedKeys(!1),halfCheckedMenu:J.value.getHalfCheckedKeys()})}),300),de=()=>{if(!Y.selectData.length)return e.warning("请至少选择一条数据");a.confirm("确定删除吗？","提示",{draggable:!0,beforeClose:(a,l,t)=>{if("confirm"===a)l.confirmButtonLoading=!0,h({_ids:Y.selectData.map((e=>e._id)).join(",")}).then((a=>{t(),e.success(a.message),se()})).finally((()=>{l.confirmButtonLoading=!1}));else t()}})},re=({label:l,key:t})=>{0!=Y.selectData.length?a.confirm(`确定${l}权限吗？`,"提示",{draggable:!0,beforeClose:(a,l,s)=>{if("confirm"===a)l.confirmButtonLoading=!0,y({_ids:Y.selectData.map((e=>e._id)),status:"on"==t?1:2}).then((a=>{s(),e.success(a.message),se()})).finally((()=>{l.confirmButtonLoading=!1}));else s()}}):e.warning("请至少选择一条数据")};return(a,b)=>{var v,h;const y=f,D=p,w=g,C=s,V=i,q=o,B=n,W=d,de=r,re=u,ue=m,me=l,ce=c;return z(),M("div",E,[T(y,{formList:I(N),tableData:I(Y),onQuery:te},null,8,["formList","tableData"]),T(D,{class:"flex-1-1 overflow-auto",btnInfos:I(ee),tableList:I(X),tableData:I(Y),onClickBtn:ie},null,8,["btnInfos","tableList","tableData"]),T(w,{btnInfos:I(ee),pagination:I(Y),onClickBtn:ie,onPage:se,onSize:b[0]||(b[0]=e=>se(1,e))},null,8,["btnInfos","pagination"]),T(me,{modelValue:I(le).visible,"onUpdate:modelValue":b[7]||(b[7]=e=>I(le).visible=e),title:(null==(v=I(le))?void 0:v.title)||"标题",width:(null==(h=I(le))?void 0:h.width)||"40%",draggable:"","close-on-click-modal":!1,"destroy-on-close":"",onClosed:b[8]||(b[8]=e=>I(G).resetFields())},{footer:L((()=>{var a,l,t,s,i,o,n,d,r,u,m,c;return[O("span",$,[T(ue,{disabled:null==(t=null==(l=null==(a=I(x))?void 0:a.getters)?void 0:l.loading)?void 0:t.request,loading:null==(o=null==(i=null==(s=I(x))?void 0:s.getters)?void 0:i.loading)?void 0:o.request,onClick:b[5]||(b[5]=e=>I(le).visible=!1)},{default:L((()=>[A(" 取 消 ")])),_:1},8,["disabled","loading"]),T(ue,{disabled:null==(r=null==(d=null==(n=I(x))?void 0:n.getters)?void 0:d.loading)?void 0:r.request,loading:null==(c=null==(m=null==(u=I(x))?void 0:u.getters)?void 0:m.loading)?void 0:c.request,type:"primary",onClick:b[6]||(b[6]=a=>(async()=>{G.value&&await G.value.validate((a=>{if(a){let a={add:j,edit:_};le.formData.loading=!0,a[le.btnType](le.formData).then((a=>{le.visible=!1,e.success(a.message),["add"].includes(le.btnType)?se(1):Y.data.forEach((async e=>{le.formData._id==e._id&&Object.assign(e,await oe(e))}))})).finally((()=>{le.formData.loading=!1}))}}))})())},{default:L((()=>[A(" 保 存 ")])),_:1},8,["disabled","loading"])])]})),default:L((()=>{var e,a,l;return[T(re,{ref_key:"elfromRef",ref:G,model:I(le).formData,"label-width":"auto",disabled:null==(l=null==(a=null==(e=I(x))?void 0:e.getters)?void 0:a.loading)?void 0:l.request},{default:L((()=>[T(V,{label:"权限名称",prop:"name",rules:{required:!0,message:"不能为空",trigger:["blur"]}},{default:L((()=>[T(C,{modelValue:I(le).formData.name,"onUpdate:modelValue":b[1]||(b[1]=e=>I(le).formData.name=e),modelModifiers:{trim:!0},"show-word-limit":"",clearable:"",placeholder:"请输入"},null,8,["modelValue"])])),_:1}),T(V,{label:"状态",prop:"status",rules:{required:!0,message:"不能为空",trigger:["change"]}},{default:L((()=>[T(B,{modelValue:I(le).formData.status,"onUpdate:modelValue":b[2]||(b[2]=e=>I(le).formData.status=e),modelModifiers:{trim:!0}},{default:L((()=>[T(q,{value:1},{default:L((()=>[A(" 启 用 ")])),_:1}),T(q,{value:2},{default:L((()=>[A(" 禁 用 ")])),_:1})])),_:1},8,["modelValue"])])),_:1}),T(V,{label:"权限菜单",prop:"checkedMenu",rules:{required:!0,message:"不能为空",trigger:["change"]}},{default:L((()=>{var e,a,l,s,i;return[O("div",H,[U((z(),K(I(t),{class:"flex-1",ref_key:"treeRef",ref:J,data:I(x).getters.authMenu,"node-key":"_id","show-checkbox":"","expand-on-click-node":!1,"default-expand-all":"",onCheckChange:I(ne)},{default:L((({data:e})=>{var a;return[O("span",{class:"flex-1",onClick:a=>{return l=e,le.authBtns.length=0,Object.assign(le.clickTreeItem,l),void k(l).then((e=>{le.authBtns=e.data}));var l}},P(null==(a=null==e?void 0:e.meta)?void 0:a.title)+"("+P(ae[e.type])+") ",9,Q)]})),_:1},8,["data","onCheckChange"])),[[ce,null==(l=null==(a=null==(e=I(x))?void 0:e.getters)?void 0:a.loading)?void 0:l.request]]),I(le).authBtns.length?(z(),M("div",Z,[O("div",null,P(null==(i=null==(s=I(le).clickTreeItem)?void 0:s.meta)?void 0:i.title)+" ("+P(ae[I(le).clickTreeItem.type])+"下按钮) ",1),T(de,{modelValue:I(le).formData.btns,"onUpdate:modelValue":b[3]||(b[3]=e=>I(le).formData.btns=e)},{default:L((()=>[(z(!0),M(R,null,S(I(le).authBtns,((e,a)=>(z(),K(W,{key:a,label:e._id},{default:L((()=>{var a;return[A(P(null==(a=null==e?void 0:e.meta)?void 0:a.title),1)]})),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])):F("v-if",!0)])]})),_:1}),T(V,{label:"备注",prop:"remarks"},{default:L((()=>[T(C,{type:"textarea",modelValue:I(le).formData.remarks,"onUpdate:modelValue":b[4]||(b[4]=e=>I(le).formData.remarks=e),modelModifiers:{trim:!0},"show-word-limit":"",clearable:"",placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","disabled"])]})),_:1},8,["modelValue","title","width"])])}}}),[["__file","D:/nodejs-egg-template-runningspace/default/666f9cfd3276ef2d39826b3c/src/views/systemInfo/Auth.vue"]]);export{G as default};
