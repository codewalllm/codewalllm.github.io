<!DOCTYPE html>
<html lang="en" style="width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
  <title>2D图</title>
  <!-- 核心引擎（必须引用） -->
  <link href="http://60.30.241.14:2650/bimjs/tkengines/tkgis/v0.9.4/Widgets/widgets.css" rel="stylesheet" />
  <script src="http://60.30.241.14:2650/bimjs/tkengines/tkgis/v0.9.4/TkEngine.js"></script>
  <!-- 引擎插件（必须引用） -->
  <script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/plugin/three.min.js"></script>
  <script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/plugin/jquery-3.4.1.min.js"></script>
  <!-- 引擎二三维联动使用，不使用联动功能可不引用此js-->
  <script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/plugin/konva.min.js"></script>

  <!-- 提供对外bim功能接口（必须引用）-->
  <script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/tkbim.js"></script>
  <script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/tkbimsdk.js"></script>

</head>

<body style="width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden">
  <!-- 引擎渲染容器 -->
  <div id="tkEngineContainer" style="width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden"></div>
  <div
    style="background-color: rgba(39, 39, 39, 0.7);position: absolute;z-index: 10;top: 10px;left: 5px;display: flex;flex-direction: column;align-items: center;justify-content: space-around;color: white;border-radius: 5px;padding: 5px;">
    <div id="map2D"></div>
  </div>
</body>

<script>
  //加载场景
  TKBimSdk.Scene.loadScene(sessionStorage.getItem("token"));
  //模型参数配置
  var model = {
    baseDomain: "https://tkbim-dataserver.tfhulian.com:2627", // BIM模型数据接口服务域名地址
    projectId: "bd425ebdc86b457992a99471fd67ddae", //项目id
    viewId: "0e60c8f535b245de824f6dacf07ae5b9", //模型viewId
    modelCenter: {
      longitude: 117.24249519270747,
      latitude: 39.080722698745542,
      altitude: 3,
    }, //模型中心点坐标：{经度,纬度,高程}
    viewRatio: 50, //模型可视距离系数
  };
  // 添加模型（可在加载场景之前添加模型，此时添加模型的callback回调不起作用）
  TKBimSdk.TK3DTileset.add3DTiles_Bim(model, (viewId) => {
    //添加模型的回调方法
    TKBimSdk.TK3DTileset.setCollect([viewId], true); //设置模型组同时移动到模型位置
    // 跳转到对应点位
    TKBimSdk.Camera.setCameraInfo({
      coordinate: { "x": -2269441.2377597606, "y": 4407812.838835871, "z": 3999321.748861608 },
      rotate: {
        heading: 360,
        pitch: -89.9999982924527,
      }
    })
  });
  // 加载2D图
  loadMap2D()
  function loadMap2D() {
    let img = new Image();
    // 2D图图片地址
    img.src = "./modeldata/FloorPlanF1.png";
    img.onload = function () {
      let mapWidth = 350;
      let mapHeight = (mapWidth * img.naturalHeight) / img.naturalWidth;
      $("#map2D").css("width", `${mapWidth}px`)
      $("#map2D").css("height", `${mapHeight}px`)
      // 2D图中图片的经度
      let sizeLon = 0.000652;
      let minLon = model.modelCenter.longitude - sizeLon + 0.000013; //左经度(小值)
      let maxLon = model.modelCenter.longitude + sizeLon + 0.000013; //右经度(大值)
      // 2D图中图片的纬度
      let sizeLat = 0.00036;
      let minLat = model.modelCenter.latitude - sizeLat - 0.00003;//上纬度(小值)
      let maxLat = model.modelCenter.latitude + sizeLat - 0.00003;//下纬度(大值)
      // 打开2D图
      TKBimSdk.LinkageMap.renderMap(
        {
          containerId: "map2D", //显示地图的div元素id，必填
          imgUrl: img.src, //地图地址，必填
          extent: { //必填
            minLon, //左经度(小值)
            minLat, //上纬度(小值)
            maxLon, //右经度(大值)
            maxLat, //下纬度(大值)
          },
        }
      );
    }
  }
</script>

</html>