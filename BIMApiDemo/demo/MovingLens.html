<!DOCTYPE html>
<html lang="en" style="width: 100%;height: 100%;margin: 0;padding: 0;overflow: hidden;">

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
	<title>镜头</title>
	<!-- 核心引擎（必须引用） -->
	<link href="http://60.30.241.14:2650/bimjs/tkengines/tkgis/v0.9.4/Widgets/widgets.css" rel="stylesheet" />
	<script src="http://60.30.241.14:2650/bimjs/tkengines/tkgis/v0.9.4/TkEngine.js"></script>
	<!-- 引擎插件（必须引用） -->
	<script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/plugin/three.min.js"></script>
	<!-- 提供对外bim功能接口（必须引用）-->
	<script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/tkbim.js"></script>
	<script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/tkbimsdk.js"></script>
	<!-- jquery 引擎操作工具（必须引用）-->
	<script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/plugin/jquery-3.4.1.min.js"></script>
</head>

<body style="width: 100%;height: 100%;margin: 0;padding: 0;overflow: hidden;">
	<!-- 引擎渲染容器 -->
	<div id="tkEngineContainer" style="width: 100%;height: 100%;margin: 0;padding: 0;overflow: hidden;"></div>
	<div
		style="background-color: rgba(39, 39, 39, 0.7);position: absolute;z-index: 10;top: 10px;left: 5px;display: flex;flex-direction: column;align-items: center;justify-content: space-around;color: white;border-radius: 5px;padding: 5px;">
		<button type="button" onclick="getMoveTo()">获取当前镜头信息</button>
		<button type="button" onclick="TKBimSdk.Camera.setCameraType(0)" style="margin-top: 10px;">正交</button>
		<button type="button" onclick="TKBimSdk.Camera.setCameraType(1)" style="margin-top: 10px;">透视</button>
	</div>
	<div id="info"
		style="background-color: rgba(39, 39, 39, 0.7);position: absolute;z-index: 10;bottom: 10px;left: 5px;display: flex;flex-direction: column;align-items: center;justify-content: space-around;color: white;border-radius: 5px;padding: 5px;">
	</div>
	<!-- 获取镜头信息后放置操作按钮 -->
	<div id="operationBtn"
		style="text-align:center;background-color: rgba(39, 39, 39, 0.7);position: absolute;z-index: 10;top: 10px;left: 50%;transform: translate(-50%, 0%);border-radius: 5px;color: #fff">
	</div>
</body>

<script>
	//加载场景
	TKBimSdk.Scene.loadScene(sessionStorage.getItem("token"), null, {
		// 加载进度 - 剩余加载数
		onTilesetLoadingCb: (num) => {
			if (!num) {
				// 加载完毕获取档期镜头信息
				getMoveTo();
			}
		},
	});
	//模型参数配置
	var model = {
		baseDomain: "https://tkbim-dataserver.tfhulian.com:2627", // BIM模型数据接口服务域名地址
		projectId: "bd425ebdc86b457992a99471fd67ddae",//项目id
		viewId: "0e60c8f535b245de824f6dacf07ae5b9",//模型viewId
		modelCenter: { longitude: 117.24249519270747, latitude: 39.080722698745542, altitude: 3 }, //模型中心点坐标：{经度,纬度,高程}
		viewRatio: 50, //模型可视距离系数
	};
	// 添加模型（可在加载场景之前添加模型，此时添加模型的callback回调不起作用）
	TKBimSdk.TK3DTileset.add3DTiles_Bim(model, (viewId) => {
		//添加模型的回调方法
		TKBimSdk.TK3DTileset.setCollect([viewId], true); //设置模型组同时移动到模型位置
	});
	// 镜头的点位信息
	let moveToPos = [
		{
			coordinate: { "x": -2269447.8298529247, "y": 4407825.642301498, "z": 3999273.3827135325 },
			rotate: { heading: 4.9667541905734275e-11, pitch: -45.00041858096404 }
		},
		{
			coordinate: { "x": -2269473.9239388476, "y": 4407798.519661301, "z": 3999275.264691044 },
			rotate: { heading: 321.452865433115, "pitch": -38.81760365831674 }
		},
		{
			coordinate: { "x": -2269397.981634382, "y": 4407825.453333328, "z": 3999319.396421621 },
			rotate: { heading: 94.03199876320765, "pitch": -54.456467800913586 }
		}
	];
	operationBtn();
	// 添加镜头操作按钮
	function operationBtn() {
		let html = ""
		for (let i = 0; i < moveToPos.length; i++) {
			html += `<button type="button" onclick="moveToFun(${i})">镜头${i + 1}</button>`;
		}
		$("#operationBtn").css("padding", "5px 10px");
		$("#operationBtn").html(html)
	}
	// 获取当前镜头的点位信息
	function getMoveTo() {
		posInfo(TKBimSdk.Camera.getCameraInfo())
	}
	// 点位信息
	function posInfo(pos) {
		let html = "";
		html += `镜头信息<br />`;
		for (let key in pos) {
			html += `${key}:${JSON.stringify(pos[key])}<br />`
		}
		$("#info").html(html)
	}
	// 移动镜头
	function moveToFun(index) {
		// 当前点位数据
		let pos = moveToPos[index]
		// 镜头移动到指定坐标同时调整视角
		TKBimSdk.Camera.doCameraFly(pos)
		// 当前镜头信息
		posInfo(pos)
	}
</script>

</html>
