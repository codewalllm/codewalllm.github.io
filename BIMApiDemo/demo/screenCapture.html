<!DOCTYPE html>
<html lang="en" style="width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <title>截屏</title>
    <!-- 核心引擎（必须引用） -->
    <link href="http://60.30.241.14:2650/bimjs/tkengines/tkgis/v0.9.4/Widgets/widgets.css" rel="stylesheet" />
    <script src="http://60.30.241.14:2650/bimjs/tkengines/tkgis/v0.9.4/TkEngine.js"></script>
    <!-- 引擎插件（必须引用） -->
    <script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/plugin/three.min.js"></script>
    <!-- 提供对外bim功能接口（必须引用）-->
    <script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/tkbim.js"></script>
    <script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/tkbimsdk.js"></script>
    <!-- jquery 引擎操作工具（必须引用）-->
    <script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/plugin/jquery-3.4.1.min.js"></script>
    <!-- html2canvas 引擎截图功能使用，不使用截图功能可不引用此js -->
    <script src="http://60.30.241.14:2650/bimjs/tkengines/tkbim/v0.9.4/plugin/html2canvas.min.js"></script>
</head>

<body style="width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden">
    <!-- 引擎渲染容器 -->
    <div id="tkEngineContainer" style="width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden"></div>
    <div
        style="background-color: rgba(39, 39, 39, 0.7);position: absolute;z-index: 10;top: 10px;left: 5px;display: flex;flex-direction: column;align-items: center;justify-content: space-around;color: white;border-radius: 5px;padding: 5px;">
        <button type="button" onclick="screenCapture()">场景截屏</button>
    </div>
    <!-- 截屏后的图片 -->
    <img id="captureImg" style="position: fixed;left: 10px;bottom: 10px;max-width: 30%;border: 1px solid #ccc;"
        src="../img/thumb.png" title="场景截图" alt="查看场景截图后的位置">
</body>

<script>
    // 场景截图
    function screenCapture() {
        TKBimSdk.Scene.screenCapture((img) => { $('#captureImg').attr('src', img) })
    }
    //加载场景 - 参数全取默认值
    TKBimSdk.Scene.loadScene(sessionStorage.getItem("token"), null, {
        // 加载进度 - 剩余加载数
        onTilesetLoadingCb: (num) => { !num && screenCapture() },
    });
    //模型参数配置
    var model = {
        baseDomain: "https://tkbim-dataserver.tfhulian.com:2627", // BIM模型数据接口服务域名地址
        projectId: "bd425ebdc86b457992a99471fd67ddae", //项目id
        viewId: "0e60c8f535b245de824f6dacf07ae5b9", //模型viewId
        modelCenter: {
            longitude: 117.24249519270747,
            latitude: 39.080722698745542,
            altitude: 3,
        }, //模型中心点坐标：{经度,纬度,高程}
        viewRatio: 50, //模型可视距离系数
    };
    // 添加模型（可在加载场景之前添加模型，此时添加模型的callback回调不起作用）
    TKBimSdk.TK3DTileset.add3DTiles_Bim(model, (viewId) => {
        //添加模型的回调方法
        TKBimSdk.TK3DTileset.setCollect([viewId], true); //设置模型组同时移动到模型位置
    });
</script>

</html>